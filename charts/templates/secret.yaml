apiVersion: v1
kind: Secret
metadata:
  name: {{ include "beacon-node.fullname" . }}
  labels:
    {{- include "beacon-node.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{- if or .Values.signingKey (not (and .Values.existingSigningKeySecret .Values.existingSigningKeySecret.name)) }}
  # Signing key is required for Matrix federation
  # If not provided, a deterministic key is generated based on release name (NOT SECURE FOR PRODUCTION)
  SIGNING_KEY: {{ .Values.signingKey | default (printf "ed25519 a_%s %s" (substr 0 4 (sha256sum .Release.Name)) (b64enc (substr 0 32 (sha256sum (printf "%s-signing-key" .Release.Name))))) | quote }}
  {{- end }}
  {{- if .Values.registrationSharedSecret }}
  REGISTRATION_SHARED_SECRET: {{ .Values.registrationSharedSecret | quote }}
  {{- end }}
  {{- if not .Values.postgresql.enabled }}
  db-password: {{ .Values.externalDatabase.password | quote }}
  {{- end }}
